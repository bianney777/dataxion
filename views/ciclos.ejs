<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ciclos de Cultivo</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/css/catalogo.css">
  <link rel="stylesheet" href="/css/ciclos.css">
  <link rel="stylesheet" href="/css/brand.css">
  <script src="/js/icons.js" defer></script>
  <!-- Librerías para charts y PDF -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable" defer></script>
  <script src="/js/ciclos.js" defer></script>
  <script src="/js/app.js" defer></script>
</head>
<body class="brand-theme">
  <%- include('partial/header') %>
  <div class="layout">
    <%- include('partial/sidebar') %>
    <div class="feed">
      <section class="catalog-hero mb-8">
        <div class="hero-bg"></div>
        <div class="hero-content">
          <div class="hero-text">
            <h1>Ciclos de Cultivo</h1>
            <p class="hero-sub">Planifica, monitorea y analiza la evolución de tus ciclos productivos: siembra, desarrollo y cosecha.</p>
            <div class="hero-stats" id="cicloHeroStats">
              <div class="hstat"><span class="v" data-hs="total">0</span><span class="l">Ciclos</span></div>
              <div class="hstat"><span class="v" data-hs="progreso">0</span><span class="l">En Progreso</span></div>
              <div class="hstat"><span class="v" data-hs="completado">0</span><span class="l">Completados</span></div>
              <div class="hstat"><span class="v" data-hs="atraso">0</span><span class="l">Con Atraso</span></div>
            </div>
            <div class="hero-actions flex flex-wrap gap-2 mt-4">
              <button class="btn btn-success btn-sm" data-open-ciclo="create">+ Ciclo</button>
              <button class="btn btn-outline btn-sm" id="btnExportCiclos">Export CSV</button>
              <button class="btn btn-outline btn-sm" id="btnPdfCiclos">Reporte PDF</button>
            </div>
          </div>
        </div>
      </section>

      <section class="ciclos-filters mb-4 flex flex-wrap gap-3 items-end">
        <div>
          <label class="lbl">Buscar</label>
          <input type="search" id="cicloSearch" class="input-modern" placeholder="Nombre o estado..." />
        </div>
        <div>
          <label class="lbl">Estado</label>
          <select id="cicloEstado" class="input-modern">
            <option value="">Todos</option>
            <option value="planificado">Planificado</option>
            <option value="en_progreso">En progreso</option>
            <option value="completado">Completado</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>
        <div>
          <label class="lbl">Rango Fecha Inicio</label>
          <div class="flex gap-1">
            <input type="date" id="fiDesde" class="input-modern" />
            <input type="date" id="fiHasta" class="input-modern" />
          </div>
        </div>
        <div>
          <label class="lbl">Rango Fecha Fin Est.</label>
          <div class="flex gap-1">
            <input type="date" id="ffDesde" class="input-modern" />
            <input type="date" id="ffHasta" class="input-modern" />
          </div>
        </div>
        <div class="ml-auto flex gap-2">
          <button class="btn btn-xs" id="cicloResetFiltros">Reset</button>
        </div>
      </section>

      <section class="ciclos-layout" id="ciclosLayout">
        <div class="ciclos-grid" id="ciclosGrid" data-view="grid"></div>
        <aside class="ciclos-panel" id="ciclosPanel">
          <h3 class="panel-title">Métricas</h3>
          <div class="metric-col" id="cicloMetrics">
            <div class="m-pill" data-mx="duracionProm">Duración prom.: —</div>
            <div class="m-pill" data-mx="avanceProm">Avance prom.: —</div>
            <div class="m-pill" data-mx="tasaExito">Tasa éxito: —</div>
            <div class="m-pill" data-mx="progresoHoy">En progreso hoy: —</div>
          </div>
          <div class="charts mt-5" id="cicloCharts">
            <canvas id="chartEstados" height="140"></canvas>
            <canvas id="chartDuraciones" height="140" class="mt-4"></canvas>
          </div>
        </aside>
      </section>

    </div>
    <aside class="rightbar">
      <div class="right-card text-[12px] leading-relaxed">
        <h4 class="text-xs font-semibold tracking-wider text-slate-500 uppercase mb-1">Tip</h4>
        Usa los ciclos para agrupar cultivos por campaña o temporada. El avance se calcula según fechas estimadas vs. reales.
      </div>
    </aside>
  </div>
  <div id="modalHost" style="display:none"></div>
  <%- include('partial/footer') %>
</body>
</html>
